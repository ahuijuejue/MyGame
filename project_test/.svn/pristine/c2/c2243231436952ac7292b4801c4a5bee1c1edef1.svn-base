--[[
    公会全员邮件
]]
local UnionMailLayer = class("UnionMailLayer",function ()
	return display.newColorLayer(cc.c4b(0, 0, 0, 200))
end)

local BgImg         = "Union_Mail_Bg.png"
local applyTitle    = "Mail_Name.png"
local MailSenderImg = "Mail_Sender.png"
local MailDesImg    = "Mail_Des.png"

function UnionMailLayer:ctor()
	self:initData()
	self:initView()
end

function UnionMailLayer:initData()
	self.senderName = UserData.name  -- 发送者
	self.sendMSg    = ""  -- 邮件内容
end

function UnionMailLayer:initView()
	self.spriteBg = display.newSprite(BgImg):pos(display.cx-5,display.cy-20):addTo(self)
	display.newSprite(applyTitle):pos(380, 425):addTo(self.spriteBg)

    local posX = 180
	local label1 = display.newTTFLabel({text = "发送人：",color = cc.c3b(254, 231, 93), size = 24})
    label1:pos(posX-label1:getContentSize().width/2,350):addTo(self.spriteBg)

    display.newSprite(MailSenderImg):pos(posX+210, 350):addTo(self.spriteBg)
    local senderName = display.newTTFLabel({text = self.senderName,color = cc.c3b(254, 231, 93), size = 24})
    senderName:pos(posX+senderName:getContentSize().width/2,350):addTo(self.spriteBg)

    local label2 = display.newTTFLabel({text = "邮件内容：",color = cc.c3b(254, 231, 93), size = 24})
    label2:pos(posX-label2:getContentSize().width/2,280):addTo(self.spriteBg)

    CommonButton.yellow("取消", {color = cc.c3b(252, 242, 181)})
    :onButtonClicked(function ()
    	self.delegate:removeUnionMailLayer()
		print("取消")
	end)
	:addTo(self.spriteBg)
	:pos(185, 65)

	CommonButton.yellow("发送", {color = cc.c3b(252, 242, 181)})
    :onButtonClicked(function ()
		print("发送")
	end)
	:pos(585,65)
	:addTo(self.spriteBg)

	self:createEditBox()
end

function UnionMailLayer:createEditBox()
		-- 输入框
	local function onEdit(event, editbox)
		if event == "began" then
	        -- 开始输入
	    elseif event == "changed" then
			-- 输入框内容发生变化
	        local _text = editbox:getText()
            self.sendMSg = _text

			local _trimed = string.trim(_text)
		    _trimed = parseString(_trimed, 1000, 2)

			if _trimed ~= _text then
				editbox:setText(_trimed)
			end

	    elseif event == "ended" then
	        -- 输入结束
	    elseif event == "return" then
	        -- 从输入框返回
	    end
	end

	local textBack = display.newScale9Sprite(MailDesImg)
	textBack:setOpacity(100)

	self.textfield = cc.ui.UIInput.new({
	    UIInputType = 1,
	    image = textBack,
	    -- "Input_Box.png",
	    size = cc.size(529, 199),
	   	x = 190,
	    y = 200,
	    listener = onEdit,
	}):addTo(self.spriteBg)
	:align(display.LEFT_CENTER)
	self.textfield:setMaxLength(66)

end

return UnionMailLayer

