local UnionLayer = class("UnionLayer",function ()
	return display.newNode()
end)

local signImg  = "Union_Church.png"
local hallImg  = "Union_Hall.png"
local idImg    = "union_id.png"
local shopImg  = ""
local fightImg = ""
local stageImg = ""
local pointImage = "Point_Red.png"

function UnionLayer:ctor()
    self:initData()
    self:initView()
end

function UnionLayer:initData()
    self.isSend = false
    self.noticeMsg = UnionListData.unionData.notice
end

function UnionLayer:initView()
    local image_ = {normal = idImg}
    self.unionIdImg = CommonButton.yellow3("", {image = image_})
    :onButtonClicked(function ()
        if UnionListData:getUnionDuty() ~= "4" then
            self.delegate:createUnionEditBox({
                msg        = self.noticeMsg,
                fontNum    = 100,
                width      = 160,
                height     = 24,
                posX       = display.cx - 360,
                posY       = display.cy - 100,
                des        = "修改公告",
                maxLength  = 70,
                changeType = 2,
                })
        end
    end)
    :pos(display.cx - 360, display.cy - 170):addTo(self,3)

    self:createStageInfo()
end

function UnionLayer:createStageInfo()

    -- 公会签到
    local image_ = {normal = signImg}
    self.signBtn = CommonButton.yellow3("", {image = image_})
    :onButtonClicked(function()
        -- NetHandler.gameRequest("GetUnionSignInfo")
        app:pushToScene("UnionSignInScene")
    end)
    :pos(display.cx - 330, display.cy + 150)
    :addTo(self,3)

    self.signRedPoint = display.newSprite(pointImage):pos(40, 80):zorder(11)
    self.signRedPoint:setVisible(false)
    self.signBtn:addChild(self.signRedPoint)

    -- 公会大厅
    local image_ = {normal = hallImg}
    self.hallBtn = CommonButton.yellow3("", {image = image_})
    :onButtonClicked(function()
        app:pushToScene("UnionHallScene")
    end)
    :pos(display.cx + 15, display.cy + 150)
    :addTo(self,3)

    self.applyRedPoint = display.newSprite(pointImage):pos(70, 86):zorder(11)
    self.applyRedPoint:setVisible(false)
    self.hallBtn:addChild(self.applyRedPoint)

    -- local image_ = {normal = shopImg}
    -- self.shopBtn = CommonButton.yellow3("", {image = image_})
    -- :onButtonClicked(function ()
    --     SceneData:pushScene("ShopUnion", self)
    -- end)
    -- :pos(display.cx - 120, display.cy - 110)
    -- :addTo(self,3)

    -- local image_ = {normal = fightImg}
    -- self.fightBtn = CommonButton.yellow3("", {image = image_})
    -- :onButtonClicked(function ()
    --     print("战争之地...")
    -- end)
    -- :pos(display.cx + 280, display.cy - 140)
    -- :addTo(self,3)

    -- local image_ = {normal = stageImg}
    -- self.stageBtn = CommonButton.yellow3("", {image = image_})
    -- :onButtonClicked(function ()
    --     print("公会副本...")
    -- end)
    -- :pos(display.cx + 270, display.cy + 150)
    -- :addTo(self,3)

end

function UnionLayer:updateData()
    self.noticeMsg = UnionListData.unionData.notice
end

function UnionLayer:updateView()
    if self.des then
        self.des:removeFromParent()
        self.des = nil
    end
    self.des = base.TalkLabel.new({
                text  = self.noticeMsg,
                size  = 18,
                dimensions = cc.size(150, 0),
                color = CommonView.color_black()
            })
    self.des:pos(-75, 85 - 22*self.des:getLines())
    self.des:addTo(self.unionIdImg,5)

    -- 签到红点
    self.signRedPoint:setVisible(UnionListData:isShowSignRedPoint())

    -- 申请人红点
    self.applyRedPoint:setVisible(UnionListData:isShowApplyRedPoint())

end

return UnionLayer
