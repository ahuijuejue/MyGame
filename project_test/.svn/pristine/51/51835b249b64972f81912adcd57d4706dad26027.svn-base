local BackfeedLayer = class("BackfeedLayer",function()
	return display.newNode()
end)

DiscountShopData = require("app.data.DiscountShopData").new() --暂用数据
local payImage1 = "flip_pay1.png"
local payImage2 = "flip_pay2.png"
local payImage3 = "flip_pay3.png"
local backImage = "backfeed_bg.png"


function BackfeedLayer:ctor()
	self.closeFunc = nil
	self.arr = DiscountShopData.data --TODO
	self:createBackView()
end

function BackfeedLayer:createBackView()
	CommonView.blackLayer2()
	:addTo(self)

	self.backSprite = display.newSprite(backImage)
	self.backSprite:setPosition(display.cx,display.cy)
	self:addChild(self.backSprite)

	CommonButton.close():addTo(self.backSprite):pos(905,545)
	:scale(0.8)
	:onButtonClicked(function()
		CommonSound.close()
		if self.closeFunc then
			self.closeFunc()
		end
	end)
	--充值按钮
	self.btnPay = cc.ui.UIPushButton.new({normal = flip_pay1,pressed = flip_pay2})
    :addTo(self.backSprite)
    :pos(300,255)

	createOutlineLabel({text = "金钱",size = 24})
	:addTo(self.backSprite)
	:pos(220,500)

	createOutlineLabel({text = "活动规则: 1.达成一个阶段的充值任务后,第二天凌晨5点开启下一个阶段.\n             2.每一个阶段只累积当天的充值金额.\n             3.本活动将于              后消失,所有未领奖励将自动发放邮箱\n               ",size = 15})
	:addTo(self.backSprite)
	:pos(370,110)


	self:createItemsView(4)
end

--显示商品
function BackfeedLayer:createItemsView(index)
	local itemDes = self.arr[index]
	local posX = 0-(#(itemDes.GiftItemID) - 1)*50
	local addX = 100
	for j=1,#(itemDes.GiftItemID) do
    	self:showItem(tostring(itemDes.GiftItemID[j]), tonumber(itemDes.GiftItemNum[j]))
    	:addTo(self.backSprite)
    	:pos(posX+(j-1)*addX+350,400)
    	:zorder(10)

    end
end

--显示商品列表
function BackfeedLayer:showItem(itemId, count)
    local grid = UserData:createItemView(itemId, {scale=0.7})

    local label = base.Label.new({
        text = tostring(count),
        size = 18,
        color = CommonView.color_white(),
    })
    :align(display.BOTTOM_RIGHT)
    :pos(50, -50)

    grid:addItem(label)

    return grid
end

function BackfeedLayer:createBackfeedBtn()

end

return BackfeedLayer