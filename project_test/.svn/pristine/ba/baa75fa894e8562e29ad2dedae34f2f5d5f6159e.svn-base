--[[
    公会主界面
]]

local BasicScene = import("..ui.BasicScene")
local UnionScene = class("UnionScene", BasicScene)

local UnionLayer = import("..views.union.UnionLayer")
local MenuNode = import("..views.main.MenuNode")

local TAG = "UnionScene"
local bgImageName = "Background_gray.jpg"
local skyImage = "Sky_Left.png"
local backImage = "Return.png"
local backImage2 = "Return_Light.png"

function UnionScene:ctor()
	UnionScene.super.ctor(self,TAG)
	self:createBackground()
	self:createBackBtn()
	self:createMenuNode()
	self:createEnterLayer()
end

function UnionScene:createBackground()
    local bgSprite = display.newSprite(bgImageName)
    bgSprite:setPosition(display.cx,display.cy)
    self:addChild(bgSprite)

    local skySprite = display.newSprite(skyImage)
    skySprite:setPosition(display.cx,bgSprite:getContentSize().height - skySprite:getContentSize().height/2)
    self:addChild(skySprite,-1)

    local colorLayer = display.newColorLayer(cc.c4b(0,0,0,170))
    self:addChild(colorLayer)
end

function UnionScene:createBackBtn()
    local backBtn = cc.ui.UIPushButton.new({normal = backImage, pressed = backImage2})
    :onButtonClicked(function ()
        AudioManage.playSound("Back.mp3")
        app:popToScene()
    end)
    self:addChild(backBtn,4)

    local posX = display.width - 55
    local posY = display.height - 45
    backBtn:setPosition(posX,posY)
end

function UnionScene:createMenuNode()
	local menuNode = MenuNode.new()
    menuNode:setPosition(display.width-60,50)
    menuNode:setHorBtnVisible(false)
    self:addChild(menuNode,4)
end

function UnionScene:createEnterLayer()
	self.unionLayer = UnionLayer.new()
	self:addChild(self.unionLayer)
end

function UnionScene:netCallback(event)
    local data = event.data
    local order = data.order
    if order == OperationCode.OpenShopProcess and tonumber(data.param1) == 7 then   -- 进入公会商店  商店类型
        app:pushToScene("ShopUnionScene")
    end
end


function UnionScene:onEnter()
    self.netEvent = GameDispatcher:addEventListener(EVENT_CONSTANT.NET_CALLBACK,handler(self,self.netCallback))
end

function UnionScene:onExit()
	GameDispatcher:removeEventListener(self.netEvent)
end

return UnionScene
