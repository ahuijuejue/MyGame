--[[
    公会副本规则
]]

local UnionAgentLayer = class("UnionAgentLayer", function()
	return display.newColorLayer(cc.c4f(0, 0, 0, 200))
end)
local BgImg = "Union_Mail_Bg.png"
local title = "union_agent_title.png"
local word = "union_agent_word.png"
local list = "union_agent_list.png"

function UnionAgentLayer:ctor()
	self:initData()
	self:initView()
end

function UnionAgentLayer:initData()

end

function UnionAgentLayer:initView()
	self.spriteBg = display.newSprite(BgImg):pos(display.cx-5,display.cy-20):addTo(self)
	display.newSprite(title):pos(390, 440):addTo(self.spriteBg)
	display.newSprite(word):pos(390, 447):addTo(self.spriteBg)

	-- 关闭按钮
	CommonButton.close()
	:addTo(self.spriteBg,3)
	:pos(760, 445)
	:scale(0.7)
	:onButtonClicked(function()
		CommonSound.close() -- 音效
		self.delegate:removeAgentLayer()
	end)

	CommonButton.yellow("说明", {color = cc.c3b(252, 242, 181), size = 24})
    :onButtonClicked(function ()
    	self.delegate:createAgentDesLayer()
        print("说明")
    end)
    :pos(145, 52)
    :addTo(self.spriteBg)

    CommonButton.yellow("派出佣兵", {color = cc.c3b(252, 242, 181), size = 24})
    :onButtonClicked(function ()
        print("派出佣兵")
    end)
    :pos(565, 52)
    :addTo(self.spriteBg)

	-- 雇佣兵list
    self.listView = cc.TableView:create(cc.size(766,306))
    self.listView:setPosition(40,87)
    self.listView:setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL)
    self.listView:setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN)
    self.listView:setDelegate()

    self.listView:registerScriptHandler(handler(self, self.scrollViewDidScroll), 0)
    self.listView:registerScriptHandler(handler(self, self.tableCellTouched), cc.TABLECELL_TOUCHED)
    self.listView:registerScriptHandler(handler(self, self.cellSizeForTable), cc.TABLECELL_SIZE_FOR_INDEX)
    self.listView:registerScriptHandler(handler(self, self.tableCellAtIndex), cc.TABLECELL_SIZE_AT_INDEX)
    self.listView:registerScriptHandler(handler(self, self.numberOfCellsInTableView), cc.NUMBER_OF_CELLS_IN_TABLEVIEW)
    self.listView:reloadData()
    self.spriteBg:addChild(self.listView)

end

function UnionAgentLayer:scrollViewDidScroll(table)

end

function UnionAgentLayer:tableCellTouched(table,cell)
	print("cellIdx:"..cell:getIdx())
end

function UnionAgentLayer:cellSizeForTable(table,idx)
	  return 110
end

function UnionAgentLayer:tableCellAtIndex(table,idx)
	  return self:createCell(idx)
end

function UnionAgentLayer:numberOfCellsInTableView(table)
	  return 10
end

function UnionAgentLayer:createCell(idx)
	local cell = cc.TableViewCell:new()
	cell:setIdx(idx)

    local bgSprite = display.newSprite(list)
    bgSprite:setAnchorPoint(0,0)
    cell:addChild(bgSprite)

    display.newSprite("Mail_Circle.png"):scale(0.75):pos(80, 50):addTo(cell)
    display.newSprite(UserData.headIcon):pos(80, 47):addTo(cell):scale(0.7)
    local posX = 240
    local gainTotal = display.newTTFLabel({text = "1000000", color = cc.c3b(252, 242, 181), size = 18}):addTo(cell)
    gainTotal:pos(posX+gainTotal:getContentSize().width/2, 60)
    local time = display.newTTFLabel({text = "11小时11分钟", color = cc.c3b(252, 242, 181), size = 18}):addTo(cell)
    time:pos(posX+time:getContentSize().width/2, 30)

    CommonButton.yellow("立即归队", {color = cc.c3b(252, 242, 181), size = 24})
    :onButtonClicked(function ()
        print("立即归队")
    end)
    :pos(590, 55)
    :addTo(cell)
    :scale(0.9)

    return cell
end

function UnionAgentLayer:updateData()

end

function UnionAgentLayer:updateView()

end

return UnionAgentLayer
