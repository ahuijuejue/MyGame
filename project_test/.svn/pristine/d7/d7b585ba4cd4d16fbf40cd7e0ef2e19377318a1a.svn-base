local UnionCreateLayer = class("UnionCreateLayer",function ()
	return display.newNode()
end)

local UnionIconListLayer = import(".UnionIconListLayer")
local nameInput = "Union_Name.png"
local iconInput = "Union_Icon.png"

function UnionCreateLayer:ctor()
	self.layer_ = display.newLayer()
	:pos(display.cx,display.cy)
	:addTo(self)
	self.layer_:setAnchorPoint(0.5,0.5)
	self.layer_:setTouchEnabled(true)
	self.layer_:setTouchSwallowEnabled(false)

	print("公会开始..UnionCreateLayer")
	--"公会名称"
	local nameLabel = display.newTTFLabel({text = "公会名称:",color = CommonView.color_black(),size = 22})
	nameLabel:pos(310,355)
	nameLabel:addTo(self.layer_)
	--线
	display.newSprite("Union_Line.png")
	:pos(510,310)
	:addTo(self.layer_)
	--input公会名称
	self:initInputView()
	--线
	display.newSprite("Union_Line.png")
	:pos(510,200)
	:addTo(self.layer_)
	--"公会图标"
	local nameLabel = display.newTTFLabel({text = "公会图标:",color = CommonView.color_black(),size = 22})
	nameLabel:pos(310,260)
	nameLabel:addTo(self.layer_)
	--"创建花费"
	local nameLabel = display.newTTFLabel({text = "创建花费:",color = CommonView.color_black(),size = 22})
	nameLabel:pos(310,160)
	nameLabel:addTo(self.layer_)
	--"显示默认图标"
	self.iconInput = display.newSprite("union001.png")
	self.iconInput:pos(500,260)
	self.iconInput:addTo(self.layer_)

	--按钮
	self:createBtns()
	
	--金币 读表
	local moneyPay = GameConfig.ConsortiaInfo[tostring(1)].Consortiaestablishcost
	dump(self.arr)
	display.newSprite("Diamond60.png")
	:pos(475,160)
	:scale(0.5)
	:addTo(self.layer_)


	self.priceLabel = base.Label.new({text = moneyPay,color=CommonView.color_black(), size=22,border = false,shadow = 1})
	:align(display.CENTER)
	:addTo(self.layer_)
	:pos(530, 160)
end

function UnionCreateLayer:createBtns()
	--修改按钮
	self.changeBtn = CommonButton.yellow("修改")
	:onButtonClicked(function ( )
		print("点击了修改按钮")
		self.textName:setVisible(false)
		self.listLayer = UnionIconListLayer.new()
		self.listLayer.delegate = self
		self.listLayer:pos(280,90)
		self:addChild(self.listLayer)
	end)
	self.changeBtn:setPosition(660,260)
	self.changeBtn:addTo(self.layer_)

	--创建公会按钮
	self.changeBtn = CommonButton.yellow("创建公会")
	:onButtonClicked(function ( )
		print("点击了创建公会")
	end)
	self.changeBtn:setPosition(660,160)
	self.changeBtn:addTo(self.layer_)

end

--控制输入框显示
function UnionCreateLayer:setInputVisible(b)
	self.textName:setVisible(b)
	print("控制输入框显示")
end

function UnionCreateLayer:removeIconListLayer()
	self.textName:setVisible(true)
	self.listLayer:removeFromParent(true)
	self.listLayer = nil
end

function UnionCreateLayer:updateUnionIcon(index)
	self.iconInput:setTexture(self.listLayer.data[index])
end

-- 输入公会名
function UnionCreateLayer:initInputView()
		-- 	-- 输入框监听
	local function onEdit(event, editbox)
	    if event == "began" then
	        print("开始输入")
	    elseif event == "changed" then
	        print("内容发生变化")
	        local _text = editbox:getText()
	        print("_text...".._text)
			local _trimed = string.trim(_text)
			print("_trimed...".._trimed)
			_trimed = parseString(_trimed, 12, 2)
			print("_trimed2...".._trimed)
			if _trimed ~= _text then
			    editbox:setText(_trimed)
			end
	    elseif event == "ended" then
	    	print("输入结束")
	        -- 输入结束
	    elseif event == "return" then
	        -- 从输入框返回
	        print("从输入框返回")
	    end
	end

	local textBack = display.newScale9Sprite(nameInput)
	-- textBack:setOpacity(100)
	self.textName = cc.ui.UIInput.new({
	    UIInputType = 1,
	    image = textBack,
	    size = cc.size(250, 40),
	   	x = 80,
	    y = 80,
	    listener = onEdit,
	}):addTo(self.layer_,0)
	:pos(570,360)
	:align(display.CENTER)
	self.textName:setPlaceHolder("在此输入公会名")
	self.textName:setMaxLength(10)

end

return UnionCreateLayer