--[[
    公会日志
]]
local UnionLogLayer = class("UnionLogLayer",function ()
	return display.newColorLayer(cc.c4b(0, 0, 0, 200))
end)

local BgImg = "union_member_bg.png"
local listImage = "union_list_bg.png"

function UnionLogLayer:ctor()
	self:initData()
	self:initView()
end

function UnionLogLayer:initData()
	self.msg = {"反馈及佛山的减肥了圣诞节疯狂了圣诞节分时间段佛四等奖佛偈手动分IOS积分",
                "fjdsoifjj福建省都if发反反复复方式冬季佛is大姐夫iOS的"}
end

function UnionLogLayer:initView()

	self.spriteBg = display.newSprite(BgImg):pos(display.cx-5,display.cy-20):addTo(self)

	-- 关闭按钮
	CommonButton.close()
	:addTo(self.spriteBg,3)
	:pos(640, 405)
	:scale(0.8)
	:onButtonClicked(function()
		CommonSound.close() -- 音效
		self.delegate:removeUnionLogLayer()
	end)

	--成员list
    self.listView = cc.TableView:create(cc.size(610,377))
	self.listView:setPosition(17,18)
	self.listView:setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL)
	self.listView:setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN)
    self.listView:setDelegate()

    self.listView:registerScriptHandler(handler(self, self.scrollViewDidScroll), 0)
    self.listView:registerScriptHandler(handler(self, self.tableCellTouched), cc.TABLECELL_TOUCHED)
	self.listView:registerScriptHandler(handler(self, self.cellSizeForTable), cc.TABLECELL_SIZE_FOR_INDEX)
    self.listView:registerScriptHandler(handler(self, self.tableCellAtIndex), cc.TABLECELL_SIZE_AT_INDEX)
    self.listView:registerScriptHandler(handler(self, self.numberOfCellsInTableView), cc.NUMBER_OF_CELLS_IN_TABLEVIEW)
    self.listView:reloadData()
	self.spriteBg:addChild(self.listView)

end

function UnionLogLayer:scrollViewDidScroll(table)

end

function UnionLogLayer:tableCellTouched(table,cell)
	-- print("cellIdx:"..cell:getIdx())
end

function UnionLogLayer:cellSizeForTable(table,idx)
	if #self.msg == 0 then
		return 33
	else
		local data = self.msg[idx+1]
	    local itemHeight = 0
		local msg = base.TalkLabel.new({
	    		text  = tostring(idx+1)..". "..data,
				size  = 18,
				dimensions = cc.size(570,0),
	    	})
		itemHeight = 20*msg:getLines() + 13
		return itemHeight
	end
end

function UnionLogLayer:tableCellAtIndex(table,idx)
	return self:createCell(idx)
end

function UnionLogLayer:numberOfCellsInTableView(table)
	return #self.msg
end

function UnionLogLayer:createCell(idx)
	local cell = cc.TableViewCell:new()
	cell:setIdx(idx)

    local data  = self.msg[idx+1]
    local itemHeight = 0
    local msg = base.TalkLabel.new({
    		text  = tostring(idx+1)..". "..data,
			size  = 18,
			dimensions = cc.size(570,0),
    	})
    itemHeight = 20*msg:getLines()
	if msg:getLines() == 1 then
        msg:pos(20, 10):addTo(cell)
	else
		msg:pos(20, itemHeight+7-20*msg:getLines()):addTo(cell)
	end

    return cell
end

function UnionLogLayer:updateData()
	-- body
end

function UnionLogLayer:updateView()
	self.listView:reloadData()
end

return UnionLogLayer
