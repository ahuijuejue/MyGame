local UnionApplyLayer = class("UnionApplyLayer",function ()
	return display.newColorLayer(cc.c4b(0, 0, 0, 200))
end)

local listImage = "union_list_bg.png"
local BgImg = "Union_Mail_Bg.png"
local applyTitle = "union_apply_title.png"

function UnionApplyLayer:ctor()

	self.spriteBg = display.newSprite(BgImg):pos(display.cx-5,display.cy-20):addTo(self)
	display.newSprite(applyTitle):pos(380, 425):addTo(self.spriteBg)

	-- 关闭按钮
	CommonButton.close()
	:addTo(self.spriteBg,3)
	:pos(750, 445)
	:scale(0.8)
	:onButtonClicked(function()
		CommonSound.close() -- 音效
		self.delegate:removeUnionApplyLayer()
	end)

    --申请人list
    self.listView = cc.TableView:create(cc.size(772,377))
	self.listView:setPosition(0,19)
	self.listView:setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL)
	self.listView:setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN)
    self.listView:setDelegate()

    self.listView:registerScriptHandler(handler(self, self.scrollViewDidScroll), 0)
    self.listView:registerScriptHandler(handler(self, self.tableCellTouched), cc.TABLECELL_TOUCHED)
	self.listView:registerScriptHandler(handler(self, self.cellSizeForTable), cc.TABLECELL_SIZE_FOR_INDEX)
    self.listView:registerScriptHandler(handler(self, self.tableCellAtIndex), cc.TABLECELL_SIZE_AT_INDEX)
    self.listView:registerScriptHandler(handler(self, self.numberOfCellsInTableView), cc.NUMBER_OF_CELLS_IN_TABLEVIEW)
    self.listView:reloadData()
	self.spriteBg:addChild(self.listView)

end

function UnionApplyLayer:scrollViewDidScroll(table)

end

function UnionApplyLayer:tableCellTouched(table,cell)
	-- print("cellIdx:"..cell:getIdx())
end

function UnionApplyLayer:cellSizeForTable(table,idx)
	return 105
end

function UnionApplyLayer:tableCellAtIndex(table,idx)
	return self:createCell(idx)
end

function UnionApplyLayer:numberOfCellsInTableView(table)
	return 10
end

function UnionApplyLayer:createCell(idx)
	local cell = cc.TableViewCell:new()
	cell:setIdx(idx)

	local bgSprite = display.newSprite(listImage)
    bgSprite:setAnchorPoint(0,0)
    cell:addChild(bgSprite)

    display.newSprite("union001.png"):pos(65, 50):scale(0.8):addTo(cell)

    local pos = 110
    local name = display.newTTFLabel({text = "吼吼吼吼吼吼",color = cc.c3b(254, 231, 93), size = 20})
    name:pos(pos+name:getContentSize().width/2,65)
    name:addTo(cell)

    local memLv = display.newTTFLabel({text = "lv.".."20".."   会长", color = cc.c3b(254, 231, 93), size = 20})
    memLv:pos(pos+memLv:getContentSize().width/2,30)
    memLv:addTo(cell)

    local totalP = display.newTTFLabel({text = "战力：".."99999999",color = cc.c3b(252, 242, 181), size = 20})
    totalP:pos(pos+165+totalP:getContentSize().width/2,45)
    totalP:addTo(cell)

    local pos = 670
    CommonButton.yellow("拒绝", {color = cc.c3b(252, 242, 181)})
    :onButtonClicked(function ()
    	-- 拒绝请求
    	-- self.delegate:removeUnionApplyLayer()
		print("拒绝")
	end)
	:addTo(cell)
    :scale(0.7)
	:pos(pos - 120, 45)

	CommonButton.yellow("同意", {color = cc.c3b(252, 242, 181)})
    :onButtonClicked(function ()
    	-- 同意请求
    	-- self.delegate:removeUnionApplyLayer()
		print("同意")
	end)
	:pos(pos,45)
	:addTo(cell)
    :scale(0.7)

    return cell
end

return UnionApplyLayer
