local UnionHallLayer = class("UnionHallLayer",function ()
	return display.newNode()
end)

local UnionBg = "Union_Bg.png"
local listImage = "union_list_bg.png"
local unionSliderBg = "union_slide_bg.png"
local unionSliderImg = "union_slide.png"

local GafNode = import("app.ui.GafNode")

function UnionHallLayer:ctor()
    self:initData()
    self:initView()
end

function UnionHallLayer:initData()
    self.unionData = UnionListData.unionData
    self.unionMemberData = {}
    for i,v in ipairs(UnionListData.unionMemberData) do
        table.insert(self.unionMemberData, v)
    end

    print("===============  ************* ===============")
    dump(self.unionData)
    dump(self.unionMemberData)
    print("===============  ************* ===============")
end

function UnionHallLayer:initView()
	self.backView = display.newSprite(UnionBg):pos(display.cx-5,display.cy-20):addTo(self)

	-- 公会头像
	self.unionIcon = display.newSprite("union001.png"):pos(100, 410):addTo(self.backView)

    -- 公会名 ID 等级 签名
    local pos = 155
	local member_ = "（".."1".."/".."20".."）"
    self.unionName = display.newTTFLabel({text = "哈哈哈哈哈哈"..member_, color = cc.c3b(184, 44, 17), size = 18})
    self.unionName:pos(pos+self.unionName:getContentSize().width/2,440)
    self.unionName:addTo(self.backView)

    local unionId = display.newTTFLabel({text = "公会ID：".."123456", color = cc.c3b(252, 242, 181), size = 12})
    unionId:pos(pos+unionId:getContentSize().width/2,415)
    unionId:addTo(self.backView)

    self.unionDes = display.newTTFLabel({
                    text  = "公会签名：".."一二三四五六七八九十一二三四五六七八九十",size  = 12,
                    color = cc.c3b(252, 242, 181),
                })
    self.unionDes:pos(pos+self.unionDes:getContentSize().width/2,395)
    self.unionDes:addTo(self.backView)

    self.unionLv = display.newTTFLabel({text = "公会等级：".."12",color = cc.c3b(252, 242, 181), size = 12})
    self.unionLv:pos(pos+self.unionLv:getContentSize().width/2,375)
    self.unionLv:addTo(self.backView)

    local nextLv = display.newTTFLabel({text = "距离下一等级：",color = cc.c3b(252, 242, 181), size = 12})
    nextLv:pos(pos+120+nextLv:getContentSize().width/2,375)
    nextLv:addTo(self.backView)

    -- vip经验条
    local spr = display.newSprite(unionSliderBg):addTo(self.backView):align(display.CENTER_LEFT):pos(pos+210, 375)
    self.unionSlider_ = display.newSprite(unionSliderImg):addTo(spr):align(display.CENTER_LEFT):pos(4, 11)
    self.unionSlider_:setScaleX(0.5)
    self.unionExpLabel_ = base.Label.new({text = ""}):addTo(self.backView):align(display.CENTER):pos(pos+210, 375)

    --日志按钮  管理按钮
    CommonButton.yellow("公会日志", {size = 24, color = cc.c3b(252, 242, 181)})   -- 申请加入按钮
    :onButtonClicked(function ()
        self.delegate:createUnionLogLayer()
		print("公会日志")
	end)
	:pos(730,440)
	:addTo(self.backView,3)
    :scale(0.9)

    -- if "是管理员" and "公会人数大于1人" then
    	CommonButton.yellow("公会管理", {size = 24,color = cc.c3b(252, 242, 181)})
	    :onButtonClicked(function ()
			print("公会管理")
            self.delegate:createUnionManageLayer()
		end)
		:pos(730,385)
		:addTo(self.backView,3)
        :scale(0.9)
	-- elseif not "是管理员"  then
	-- 	CommonButton.yellow("退出公会", {size = 24,color = cc.c3b(252, 242, 181)})
	--     :onButtonClicked(function ()
	-- 		print("退出公会")
	-- 	end)
	-- 	:pos(730,385)
	-- 	:addTo(self.backView,3)
 --        :scale(0.9)
 --    elseif "是管理员" and "公会人数等于1人"  then
 --        CommonButton.yellow("解散公会", {size = 24,color = cc.c3b(252, 242, 181)})
 --        :onButtonClicked(function ()
 --            print("解散公会")
 --        end)
 --        :pos(730,385)
 --        :addTo(self.backView,3)
 --        :scale(0.9)
 --    end


    --成员list
    self.listView = cc.TableView:create(cc.size(746,340))
	self.listView:setPosition(63,19)
	self.listView:setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL)
	self.listView:setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN)
    self.listView:setDelegate()

    self.listView:registerScriptHandler(handler(self, self.scrollViewDidScroll), 0)
    self.listView:registerScriptHandler(handler(self, self.tableCellTouched), cc.TABLECELL_TOUCHED)
	self.listView:registerScriptHandler(handler(self, self.cellSizeForTable), cc.TABLECELL_SIZE_FOR_INDEX)
    self.listView:registerScriptHandler(handler(self, self.tableCellAtIndex), cc.TABLECELL_SIZE_AT_INDEX)
    self.listView:registerScriptHandler(handler(self, self.numberOfCellsInTableView), cc.NUMBER_OF_CELLS_IN_TABLEVIEW)
    self.listView:reloadData()
	self.backView:addChild(self.listView)

end

function UnionHallLayer:scrollViewDidScroll(table)

end

function UnionHallLayer:tableCellTouched(table,cell)
	-- print("cellIdx:"..cell:getIdx())
end

function UnionHallLayer:cellSizeForTable(table,idx)
	return 105
end

function UnionHallLayer:tableCellAtIndex(table,idx)
	return self:createCell(idx)
end

function UnionHallLayer:numberOfCellsInTableView(table)
	return 10
end

function UnionHallLayer:createCell(idx)
	local cell = cc.TableViewCell:new()
	cell:setIdx(idx)

	local bgSprite = display.newSprite(listImage)
    bgSprite:setAnchorPoint(0,0)
    cell:addChild(bgSprite)

    local image_ = {
	    normal = "union001.png",
	    pressed = "union001.png",
	    disabled = "union001.png",
	}
    CommonButton.yellow3("",{image = image_})
    :onButtonClicked(function ()
        self.delegate:createUnionMemberLayer() -- 传入指定成员信息表
		print("查看")
	end)
	:pos(60,50)
	:addTo(cell)
    :scale(0.8)

    local pos = 110
    local name = display.newTTFLabel({text = "吼吼吼吼吼吼",color = cc.c3b(254, 231, 93), size = 20})
    name:pos(pos+name:getContentSize().width/2,65)
    name:addTo(cell)

    local memLv = display.newTTFLabel({text = "lv.".."20".."   会长", color = cc.c3b(254, 231, 93), size = 20})
    memLv:pos(pos+memLv:getContentSize().width/2,30)
    memLv:addTo(cell)

    local allH = display.newTTFLabel({text = "累计贡献".."99999999",color = cc.c3b(252, 242, 181), size = 17})
    allH:pos(pos+130+allH:getContentSize().width/2,70)
    allH:addTo(cell)

    local todayH = display.newTTFLabel({text = "今日贡献".."99999",color = cc.c3b(252, 242, 181), size = 17})
    todayH:pos(pos+130+todayH:getContentSize().width/2,40)
    todayH:addTo(cell)

    local recentL = display.newTTFLabel({text = "一小时前登陆",color = cc.c3b(252, 242, 181), size = 20})
    recentL:pos(pos+320+recentL:getContentSize().width/2,75)
    recentL:addTo(cell)

    local totalP = display.newTTFLabel({text = "战力：".."99999999",color = cc.c3b(252, 242, 181), size = 20})
    totalP:pos(pos+475+totalP:getContentSize().width/2,75)
    totalP:addTo(cell)

    local pos = 680
    local addBtn
    -- if not "是否是好友" then
        addBtn = CommonButton.yellow("添加好友", {color = cc.c3b(252, 242, 181)})
        :onButtonClicked(function ()
            print("添加好友")
        end)
        :pos(pos-120,30)
        :addTo(cell)
        :scale(0.7)
    -- else
    --     addBtn = CommonButton.yellow("删除好友", {color = cc.c3b(252, 242, 181)})
    --     :onButtonClicked(function ()
    --         print("删除好友")
    --     end)
    --     :pos(pos-120,30)
    --     :addTo(cell)
    --     :scale(0.7)
    -- end

    local checkBtn = CommonButton.yellow("查看", {color = cc.c3b(252, 242, 181)})
	    :onButtonClicked(function ()
            self.delegate:createUnionMemberLayer()
			print("查看")
		end)
		:pos(pos,30)
		:addTo(cell)
        :scale(0.7)

  --   if "会长" or "副会长" or "管理员" then
  --       addBtn:setPosition(pos- 240, 30)
  --   	checkBtn:setPosition(pos- 120, 30)

  --   	CommonButton.yellow("管理", {color = cc.c3b(252, 242, 181)})
	 --    :onButtonClicked(function ()
  --           if "会长" then
  --               -- 弹框功能：
  --           elseif "副会长" then
  --               -- 弹框功能：
  --           elseif "管理员" then
  --               -- 弹框功能：删除
  --           end
		-- 	print("管理")
		-- end)
		-- :pos(pos,30)
		-- :addTo(cell)
  --       :scale(0.7)
  --   end

  --   if "自己是会长" then
  --       if not "自己信息条" then
  --           addBtn:setPosition(pos- 240, 30)
  --           checkBtn:setPosition(pos- 120, 30)

  --           CommonButton.yellow("管理", {color = cc.c3b(252, 242, 181)})
  --           :onButtonClicked(function ()
  --               print("管理")  -- 传入成员信息，判断是否为副会长会管理员
  --           end)
  --           :pos(pos,30)
  --           :addTo(cell)
  --           :scale(0.7)
  --       end
  --   elseif "自己是副会长" then
  --       if not "自己信息条" and "会长信息条" then
  --           addBtn:setPosition(pos- 240, 30)
  --           checkBtn:setPosition(pos- 120, 30)

  --           CommonButton.yellow("管理", {color = cc.c3b(252, 242, 181)})
  --           :onButtonClicked(function ()
  --               print("管理") -- 传入成员信息，判断是否为会管理员
  --           end)
  --           :pos(pos,30)
  --           :addTo(cell)
  --           :scale(0.7)
  --       end
  --   elseif "自己是管理员" then
  --       if not "自己信息条" and "会长信息条" and "副会长信息条" then
  --           addBtn:setPosition(pos- 240, 30)
  --           checkBtn:setPosition(pos- 120, 30)

  --           CommonButton.yellow("管理", {color = cc.c3b(252, 242, 181)})
  --           :onButtonClicked(function ()
  --               print("管理") -- 删除成员
  --           end)
  --           :pos(pos,30)
  --           :addTo(cell)
  --           :scale(0.7)
  --       end
  --   end

    return cell
end

function UnionHallLayer:updateData()
	-- body
end

function UnionHallLayer:updateView()
	-- body
end

return UnionHallLayer

